using Burning.Common.Entity;
using Burning.Common.Network;
using Burning.Common.Utility.Authentication;
using FlatyBot.Common.IO;
using FlatyBot.Common.Network;
using Burning.DofusProtocol.Network.Messages;
using System;
using System.Collections.Generic;
using System.IO;
using System.Net.Sockets;
using System.Text;

namespace Burning.Emu.Network
{

    public class AuthClient : AbstractClient
    {
        public Account Account { get; set; }
        public string Ticket { get; set; }
        public List<int> Key { get; set; }
        public string salt { get; set; }

        public AuthClient(Socket socket) : base(socket)
        {
            Console.WriteLine("New client connected {0}", this.Socket.RemoteEndPoint.ToString());
            this.SendPacket(new ProtocolRequired(1945, 1945));

            #region key

            this.Key = new List<int>();
            Key.Add(111);
            Key.Add(205);
            Key.Add(118);
            Key.Add(9);
            Key.Add(52);
            Key.Add(161);
            Key.Add(97);
            Key.Add(184);
            Key.Add(109);
            Key.Add(127);
            Key.Add(46);
            Key.Add(12);
            Key.Add(169);
            Key.Add(191);
            Key.Add(118);
            Key.Add(230);
            Key.Add(231);
            Key.Add(137);
            Key.Add(3);
            Key.Add(21);
            Key.Add(67);
            Key.Add(122);
            Key.Add(75);
            Key.Add(122);
            Key.Add(214);
            Key.Add(75);
            Key.Add(244);
            Key.Add(14);
            Key.Add(128);
            Key.Add(42);
            Key.Add(73);
            Key.Add(26);
            Key.Add(105);
            Key.Add(80);
            Key.Add(107);
            Key.Add(103);
            Key.Add(129);
            Key.Add(218);
            Key.Add(124);
            Key.Add(23);
            Key.Add(84);
            Key.Add(240);
            Key.Add(1);
            Key.Add(247);
            Key.Add(18);
            Key.Add(203);
            Key.Add(216);
            Key.Add(130);
            Key.Add(139);
            Key.Add(69);
            Key.Add(2);
            Key.Add(53);
            Key.Add(200);
            Key.Add(150);
            Key.Add(217);
            Key.Add(11);
            Key.Add(99);
            Key.Add(106);
            Key.Add(94);
            Key.Add(132);
            Key.Add(216);
            Key.Add(237);
            Key.Add(143);
            Key.Add(11);
            Key.Add(88);
            Key.Add(92);
            Key.Add(34);
            Key.Add(237);
            Key.Add(29);
            Key.Add(53);
            Key.Add(164);
            Key.Add(47);
            Key.Add(228);
            Key.Add(109);
            Key.Add(111);
            Key.Add(252);
            Key.Add(143);
            Key.Add(190);
            Key.Add(155);
            Key.Add(162);
            Key.Add(238);
            Key.Add(252);
            Key.Add(221);
            Key.Add(73);
            Key.Add(85);
            Key.Add(154);
            Key.Add(203);
            Key.Add(133);
            Key.Add(67);
            Key.Add(75);
            Key.Add(53);
            Key.Add(64);
            Key.Add(218);
            Key.Add(194);
            Key.Add(108);
            Key.Add(144);
            Key.Add(165);
            Key.Add(102);
            Key.Add(254);
            Key.Add(103);
            Key.Add(238);
            Key.Add(23);
            Key.Add(129);
            Key.Add(255);
            Key.Add(2);
            Key.Add(245);
            Key.Add(106);
            Key.Add(161);
            Key.Add(111);
            Key.Add(105);
            Key.Add(148);
            Key.Add(176);
            Key.Add(109);
            Key.Add(134);
            Key.Add(120);
            Key.Add(129);
            Key.Add(31);
            Key.Add(97);
            Key.Add(143);
            Key.Add(9);
            Key.Add(179);
            Key.Add(185);
            Key.Add(137);
            Key.Add(160);
            Key.Add(34);
            Key.Add(18);
            Key.Add(207);
            Key.Add(164);
            Key.Add(17);
            Key.Add(132);
            Key.Add(239);
            Key.Add(94);
            Key.Add(110);
            Key.Add(159);
            Key.Add(203);
            Key.Add(44);
            Key.Add(192);
            Key.Add(25);
            Key.Add(5);
            Key.Add(132);
            Key.Add(31);
            Key.Add(149);
            Key.Add(235);
            Key.Add(220);
            Key.Add(252);
            Key.Add(102);
            Key.Add(128);
            Key.Add(106);
            Key.Add(230);
            Key.Add(233);
            Key.Add(30);
            Key.Add(177);
            Key.Add(250);
            Key.Add(117);
            Key.Add(39);
            Key.Add(21);
            Key.Add(70);
            Key.Add(83);
            Key.Add(149);
            Key.Add(84);
            Key.Add(183);
            Key.Add(4);
            Key.Add(84);
            Key.Add(236);
            Key.Add(173);
            Key.Add(108);
            Key.Add(201);
            Key.Add(177);
            Key.Add(53);
            Key.Add(185);
            Key.Add(97);
            Key.Add(200);
            Key.Add(128);
            Key.Add(71);
            Key.Add(202);
            Key.Add(79);
            Key.Add(162);
            Key.Add(241);
            Key.Add(57);
            Key.Add(239);
            Key.Add(23);
            Key.Add(132);
            Key.Add(134);
            Key.Add(217);
            Key.Add(157);
            Key.Add(91);
            Key.Add(199);
            Key.Add(234);
            Key.Add(150);
            Key.Add(3);
            Key.Add(95);
            Key.Add(2);
            Key.Add(26);
            Key.Add(12);
            Key.Add(183);
            Key.Add(155);
            Key.Add(79);
            Key.Add(244);
            Key.Add(16);
            Key.Add(10);
            Key.Add(155);
            Key.Add(169);
            Key.Add(219);
            Key.Add(38);
            Key.Add(141);
            Key.Add(64);
            Key.Add(117);
            Key.Add(117);
            Key.Add(164);
            Key.Add(125);
            Key.Add(176);
            Key.Add(110);
            Key.Add(204);
            Key.Add(208);
            Key.Add(155);
            Key.Add(81);
            Key.Add(106);
            Key.Add(160);
            Key.Add(128);
            Key.Add(236);
            Key.Add(237);
            Key.Add(0);
            Key.Add(66);
            Key.Add(55);
            Key.Add(120);
            Key.Add(109);
            Key.Add(222);
            Key.Add(128);
            Key.Add(61);
            Key.Add(253);
            Key.Add(22);
            Key.Add(206);
            Key.Add(5);
            Key.Add(186);
            Key.Add(127);
            Key.Add(131);
            Key.Add(37);
            Key.Add(218);
            Key.Add(38);
            Key.Add(122);
            Key.Add(63);
            Key.Add(144);
            Key.Add(244);
            Key.Add(99);
            Key.Add(227);
            Key.Add(82);
            Key.Add(14);
            Key.Add(138);
            Key.Add(39);
            Key.Add(134);
            Key.Add(177);
            Key.Add(64);
            Key.Add(234);
            Key.Add(91);
            Key.Add(67);
            Key.Add(132);
            Key.Add(113);
            Key.Add(124);
            Key.Add(102);
            Key.Add(192);
            Key.Add(109);
            Key.Add(48);
            Key.Add(143);
            Key.Add(77);
            Key.Add(2);
            Key.Add(246);
            Key.Add(87);
            Key.Add(35);
            Key.Add(240);
            Key.Add(219);
            Key.Add(114);
            Key.Add(125);
            Key.Add(215);
            Key.Add(238);
            Key.Add(171);
            Key.Add(67);
            Key.Add(27);
            Key.Add(13);
            Key.Add(139);
            Key.Add(162);
            Key.Add(70);
            Key.Add(150);
            Key.Add(161);
            Key.Add(175);
            Key.Add(213);
            Key.Add(128);
            Key.Add(122);
            Key.Add(24);
            Key.Add(5);
            Key.Add(38);
            Key.Add(72);
            Key.Add(177);
            Key.Add(63);
            Key.Add(238);
            Key.Add(190);
            Key.Add(102);
            Key.Add(182);
            Key.Add(62);
            Key.Add(158);
            Key.Add(246);
            Key.Add(183);
            Key.Add(115);
            Key.Add(158);
            Key.Add(21);
            Key.Add(114);

            #endregion

            this.salt = AuthenticationUtils.GenerateTicket(); //ticket == salt dans patch client
            this.SendPacket(new HelloConnectMessage(this.salt, this.Key));
        }

        public override void Disconnect()
        {
            this.Socket.Close();
            this.Socket.Dispose();
        }
    }
}
